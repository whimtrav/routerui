import{d as ct,f as x,a as d,s as p,c as pt}from"../chunks/DhZLAEWt.js";import{o as xt}from"../chunks/D-tgmMSQ.js";import{p as ft,s as h,a as K,ao as _t,g as e,b as bt,f as n,e as ut,$ as mt,d as i,c as s,r as a,t as R,h as we}from"../chunks/N1otwjTT.js";import{i as I}from"../chunks/CWp393YG.js";import{e as ke,i as Pe}from"../chunks/CxGl9W59.js";import{h as gt,s as Ie,c as yt}from"../chunks/DtPs97YY.js";import{r as Z}from"../chunks/uT__Kkxm.js";import{b as z}from"../chunks/DLE3Upo7.js";import{b as ht}from"../chunks/7SKTmCmy.js";var qt=x('<div class="pending-banner svelte-iqx65"><div class="flex items-center gap-4 svelte-iqx65"><div class="pending-icon svelte-iqx65">!</div> <div class="svelte-iqx65"><p class="font-semibold svelte-iqx65">Changes Pending Confirmation</p> <p class="text-sm opacity-90 svelte-iqx65">Auto-revert in <span class="font-mono font-bold svelte-iqx65"> </span></p></div></div> <div class="flex gap-2 svelte-iqx65"><button class="confirm-btn svelte-iqx65">Confirm Changes</button> <button class="revert-btn svelte-iqx65">Revert Now</button></div></div>'),wt=x('<div class="text-gray-400 svelte-iqx65">Loading...</div>'),kt=x('<p class="text-sm text-yellow-400 mt-2 svelte-iqx65">Note: When enabled, the firewall will DROP all incoming WAN traffic except established connections and LAN traffic.</p>'),Pt=x('<tr class="border-b border-gray-700/50 svelte-iqx65"><td class="py-2 uppercase text-blue-400 svelte-iqx65"> </td><td class="py-2 svelte-iqx65"> </td><td class="py-2 font-mono svelte-iqx65"> </td><td class="py-2 svelte-iqx65"><button class="text-red-400 hover:text-red-300 svelte-iqx65">Delete</button></td></tr>'),It=x('<div class="overflow-x-auto svelte-iqx65"><table class="w-full text-sm svelte-iqx65"><thead class="svelte-iqx65"><tr class="text-left text-gray-400 border-b border-gray-700 svelte-iqx65"><th class="pb-2 svelte-iqx65">Protocol</th><th class="pb-2 svelte-iqx65">External Port</th><th class="pb-2 svelte-iqx65">Internal Destination</th><th class="pb-2 svelte-iqx65">Actions</th></tr></thead><tbody class="svelte-iqx65"></tbody></table></div>'),Tt=x('<p class="text-gray-500 text-sm svelte-iqx65">No port forwards configured</p>'),jt=x('<div class="flex items-center justify-between p-2 bg-gray-700/50 rounded svelte-iqx65"><span class="font-mono text-red-400 svelte-iqx65"> </span> <button class="text-gray-400 hover:text-green-400 text-sm svelte-iqx65">Unblock</button></div>'),St=x('<div class="space-y-2 svelte-iqx65"></div>'),Ot=x('<p class="text-gray-500 text-sm svelte-iqx65">No IPs blocked</p>'),Rt=x('<button class="btn btn-danger svelte-iqx65">Disable DMZ</button>'),Dt=x('<span class="text-yellow-400 svelte-iqx65">DMZ active: All traffic forwarded to <span class="font-mono svelte-iqx65"> </span></span>'),Ct=x('<div class="space-y-4 svelte-iqx65"><div class="svelte-iqx65"><h4 class="text-sm font-semibold text-gray-400 mb-2 svelte-iqx65">Filter Table</h4> <pre class="bg-gray-900 p-3 rounded text-xs overflow-x-auto max-h-64 overflow-y-auto svelte-iqx65"> </pre></div> <div class="svelte-iqx65"><h4 class="text-sm font-semibold text-gray-400 mb-2 svelte-iqx65">NAT Table</h4> <pre class="bg-gray-900 p-3 rounded text-xs overflow-x-auto max-h-64 overflow-y-auto svelte-iqx65"> </pre></div></div>'),Nt=x('<p class="text-gray-400 svelte-iqx65">Loading...</p>'),Ft=x(`<div class="card svelte-iqx65"><div class="flex items-center justify-between svelte-iqx65"><div class="svelte-iqx65"><h3 class="text-lg font-semibold svelte-iqx65">Firewall Status</h3> <p class="text-sm text-gray-400 svelte-iqx65">Default policies - Input: <span class="font-mono svelte-iqx65"> </span>,
            Forward: <span class="font-mono svelte-iqx65"> </span>,
            Output: <span class="font-mono svelte-iqx65"> </span></p></div> <div class="flex items-center gap-4 svelte-iqx65"><span> </span> <button> </button></div></div> <!></div> <div class="card svelte-iqx65"><h3 class="text-lg font-semibold mb-4 svelte-iqx65">Port Forwarding</h3> <p class="text-sm text-gray-400 mb-4 svelte-iqx65">Forward external ports to internal devices on your network.</p> <div class="flex flex-wrap gap-2 mb-4 p-3 bg-gray-700/30 rounded svelte-iqx65"><select class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm svelte-iqx65"><option class="svelte-iqx65">TCP</option><option class="svelte-iqx65">UDP</option><option class="svelte-iqx65">Both</option></select> <input type="number" placeholder="External Port" class="w-32 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm svelte-iqx65"/> <span class="text-gray-400 self-center svelte-iqx65">to</span> <input type="text" placeholder="Internal IP (e.g. 10.22.22.100)" class="w-48 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm svelte-iqx65"/> <span class="text-gray-400 self-center svelte-iqx65">:</span> <input type="number" placeholder="Internal Port" class="w-32 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm svelte-iqx65"/> <button class="btn btn-primary svelte-iqx65">Add Rule</button></div> <!></div> <div class="card svelte-iqx65"><h3 class="text-lg font-semibold mb-4 svelte-iqx65">Blocked IPs</h3> <p class="text-sm text-gray-400 mb-4 svelte-iqx65">Block specific IP addresses from accessing your network.</p> <div class="flex gap-2 mb-4 svelte-iqx65"><input type="text" placeholder="IP address (e.g. 192.168.1.100)" class="flex-1 max-w-xs bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm svelte-iqx65"/> <button class="btn btn-danger svelte-iqx65">Block IP</button></div> <!></div> <div class="card svelte-iqx65"><h3 class="text-lg font-semibold mb-4 svelte-iqx65">DMZ (Demilitarized Zone)</h3> <p class="text-sm text-gray-400 mb-4 svelte-iqx65">Forward all incoming traffic to a single host. <span class="text-yellow-400 svelte-iqx65">Warning:</span> This exposes the target device to all external traffic.</p> <div class="flex items-center gap-4 svelte-iqx65"><div class="flex gap-2 svelte-iqx65"><input type="text" placeholder="Target IP (e.g. 10.22.22.100)" class="w-48 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm svelte-iqx65"/> <button class="btn btn-primary svelte-iqx65"> </button> <!></div> <!></div></div> <div class="card svelte-iqx65"><div class="flex items-center justify-between mb-4 svelte-iqx65"><h3 class="text-lg font-semibold svelte-iqx65">Raw iptables Rules</h3> <button class="btn btn-secondary svelte-iqx65"> </button></div> <!></div>`,1),Mt=x('<div class="space-y-6 svelte-iqx65"><h2 class="text-2xl font-bold svelte-iqx65">Firewall</h2> <!> <!></div>');function $t(Te,je){ft(je,!0);let y=h(null),Q=h(K([])),V=h(K([])),w=h(null),D=h(null),_e=h(!0),C=h(!1),T=h(K({pending:!1,seconds_remaining:null})),v=h(K({protocol:"tcp",external_port:"",internal_ip:"",internal_port:""})),N=h(""),j=h("");async function _(){try{const[t,c,b,k,P]=await Promise.all([fetch("/api/firewall/status"),fetch("/api/firewall/port-forwards"),fetch("/api/firewall/blocked-ips"),fetch("/api/firewall/dmz"),fetch("/api/firewall/pending")]);t.ok&&n(y,await t.json(),!0),c.ok&&n(Q,await c.json(),!0),b.ok&&n(V,await b.json(),!0),k.ok&&(n(w,await k.json(),!0),e(w).target_ip&&n(j,e(w).target_ip,!0)),P.ok&&n(T,await P.json(),!0)}catch(t){console.error(t)}finally{n(_e,!1)}}async function Se(){const t=await fetch("/api/firewall/rules");t.ok&&n(D,await t.json(),!0)}xt(()=>{_();const t=setInterval(()=>{_()},e(T).pending?1e3:5e3);return()=>clearInterval(t)}),_t(()=>{if(e(T).pending){const t=setInterval(_,1e3);return()=>clearInterval(t)}});async function Oe(){const t=await fetch("/api/firewall/toggle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:!e(y).enabled})});t.ok&&(n(y,await t.json(),!0),_())}async function Re(){const t=await fetch("/api/firewall/confirm",{method:"POST"});t.ok&&(n(T,await t.json(),!0),_())}async function De(){const t=await fetch("/api/firewall/revert",{method:"POST"});t.ok&&(n(T,await t.json(),!0),_())}async function Ce(){if(!e(v).external_port||!e(v).internal_ip||!e(v).internal_port)return;(await fetch("/api/firewall/port-forwards/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({protocol:e(v).protocol,external_port:parseInt(e(v).external_port),internal_ip:e(v).internal_ip,internal_port:parseInt(e(v).internal_port)})})).ok&&(n(v,{protocol:"tcp",external_port:"",internal_ip:"",internal_port:""},!0),_())}async function Ne(t){(await fetch("/api/firewall/port-forwards/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({protocol:t.protocol,external_port:t.external_port,internal_ip:t.internal_ip,internal_port:t.internal_port})})).ok&&_()}async function be(){if(!e(N).trim())return;(await fetch("/api/firewall/blocked-ips/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:e(N).trim()})})).ok&&(n(N,""),_())}async function Fe(t){(await fetch("/api/firewall/blocked-ips/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:t})})).ok&&_()}async function Me(){const t=await fetch("/api/firewall/dmz/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:!!e(j).trim(),target_ip:e(j).trim()||null})});t.ok&&(n(w,await t.json(),!0),_())}async function Ae(){const t=await fetch("/api/firewall/dmz/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:!1,target_ip:null})});t.ok&&(n(w,await t.json(),!0),n(j,""),_())}function Ze(t){const c=Math.floor(t/60),b=t%60;return`${c}:${b.toString().padStart(2,"0")}`}var X=Mt();gt("iqx65",t=>{ut(()=>{mt.title="Firewall - RouterUI"})});var ue=i(s(X),2);{var ze=t=>{var c=qt(),b=s(c),k=i(s(b),2),P=i(s(k),2),F=i(s(P)),M=s(F,!0);a(F),a(P),a(k),a(b);var B=i(b,2),S=s(B);S.__click=Re;var Y=i(S,2);Y.__click=De,a(B),a(c),R(E=>p(M,E),[()=>Ze(e(T).seconds_remaining||0)]),d(t,c)};I(ue,t=>{e(T).pending&&t(ze)})}var Be=i(ue,2);{var Ee=t=>{var c=wt();d(t,c)},Je=t=>{var c=Ft(),b=we(c),k=s(b),P=s(k),F=i(s(P),2),M=i(s(F)),B=s(M,!0);a(M);var S=i(M,2),Y=s(S,!0);a(S);var E=i(S,2),Ue=s(E,!0);a(E),a(F),a(P);var me=i(P,2),J=s(me),Le=s(J,!0);a(J);var U=i(J,2);U.__click=Oe;var We=s(U,!0);a(U),a(me),a(k);var $e=i(k,2);{var He=r=>{var l=kt();d(r,l)};I($e,r=>{var l;(l=e(y))!=null&&l.enabled||r(He)})}a(b);var ee=i(b,2),te=i(s(ee),4),L=s(te),ae=s(L);ae.value=ae.__value="tcp";var re=i(ae);re.value=re.__value="udp";var ge=i(re);ge.value=ge.__value="both",a(L);var se=i(L,2);Z(se);var ie=i(se,4);Z(ie);var le=i(ie,4);Z(le);var Ge=i(le,2);Ge.__click=Ce,a(te);var Ke=i(te,2);{var Qe=r=>{var l=It(),u=s(l),m=i(s(u));ke(m,21,()=>e(Q),Pe,(q,o)=>{var f=Pt(),g=s(f),H=s(g,!0);a(g);var A=i(g),G=s(A,!0);a(A);var O=i(A),fe=s(O);a(O);var qe=i(O),dt=s(qe);dt.__click=()=>Ne(e(o)),a(qe),a(f),R(()=>{p(H,e(o).protocol),p(G,e(o).external_port),p(fe,`${e(o).internal_ip??""}:${e(o).internal_port??""}`)}),d(q,f)}),a(m),a(u),a(l),d(r,l)},Ve=r=>{var l=Tt();d(r,l)};I(Ke,r=>{e(Q).length>0?r(Qe):r(Ve,!1)})}a(ee);var oe=i(ee,2),ne=i(s(oe),4),W=s(ne);Z(W),W.__keydown=r=>r.key==="Enter"&&be();var Xe=i(W,2);Xe.__click=be,a(ne);var Ye=i(ne,2);{var et=r=>{var l=St();ke(l,21,()=>e(V),Pe,(u,m)=>{var q=jt(),o=s(q),f=s(o,!0);a(o);var g=i(o,2);g.__click=()=>Fe(e(m).ip),a(q),R(()=>p(f,e(m).ip)),d(u,q)}),a(l),d(r,l)},tt=r=>{var l=Ot();d(r,l)};I(Ye,r=>{e(V).length>0?r(et):r(tt,!1)})}a(oe);var ve=i(oe,2),ye=i(s(ve),4),de=s(ye),ce=s(de);Z(ce);var $=i(ce,2);$.__click=Me;var at=s($,!0);a($);var rt=i($,2);{var st=r=>{var l=Rt();l.__click=Ae,d(r,l)};I(rt,r=>{var l;(l=e(w))!=null&&l.enabled&&r(st)})}a(de);var it=i(de,2);{var lt=r=>{var l=Dt(),u=i(s(l)),m=s(u,!0);a(u),a(l),R(()=>p(m,e(w).target_ip)),d(r,l)};I(it,r=>{var l;(l=e(w))!=null&&l.enabled&&r(lt)})}a(ye),a(ve);var he=i(ve,2),pe=s(he),xe=i(s(pe),2);xe.__click=()=>{n(C,!e(C)),e(C)&&!e(D)&&Se()};var ot=s(xe);a(xe),a(pe);var nt=i(pe,2);{var vt=r=>{var l=pt(),u=we(l);{var m=o=>{var f=Ct(),g=s(f),H=i(s(g),2),A=s(H,!0);a(H),a(g);var G=i(g,2),O=i(s(G),2),fe=s(O,!0);a(O),a(G),a(f),R(()=>{p(A,e(D).filter),p(fe,e(D).nat)}),d(o,f)},q=o=>{var f=Nt();d(o,f)};I(u,o=>{e(D)?o(m):o(q,!1)})}d(r,l)};I(nt,r=>{e(C)&&r(vt)})}a(he),R(()=>{var r,l,u,m,q,o,f,g;p(B,(r=e(y))==null?void 0:r.input_policy),p(Y,(l=e(y))==null?void 0:l.forward_policy),p(Ue,(u=e(y))==null?void 0:u.output_policy),Ie(J,1,yt((m=e(y))!=null&&m.enabled?"status-active":"status-inactive"),"svelte-iqx65"),p(Le,(q=e(y))!=null&&q.enabled?"Enabled (DROP)":"Disabled (ACCEPT)"),Ie(U,1,`btn ${(o=e(y))!=null&&o.enabled?"btn-danger":"btn-primary"}`,"svelte-iqx65"),p(We,(f=e(y))!=null&&f.enabled?"Disable":"Enable"),p(at,(g=e(w))!=null&&g.enabled?"Update DMZ":"Enable DMZ"),p(ot,`${e(C)?"Hide":"Show"} Raw Rules`)}),ht(L,()=>e(v).protocol,r=>e(v).protocol=r),z(se,()=>e(v).external_port,r=>e(v).external_port=r),z(ie,()=>e(v).internal_ip,r=>e(v).internal_ip=r),z(le,()=>e(v).internal_port,r=>e(v).internal_port=r),z(W,()=>e(N),r=>n(N,r)),z(ce,()=>e(j),r=>n(j,r)),d(t,c)};I(Be,t=>{e(_e)?t(Ee):t(Je,!1)})}a(X),d(Te,X),bt()}ct(["click","keydown"]);export{$t as component};
