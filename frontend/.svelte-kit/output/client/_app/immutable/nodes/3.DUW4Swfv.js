import{d as Nt,f as y,a as f,s as v}from"../chunks/DhZLAEWt.js";import{o as Tt}from"../chunks/D-tgmMSQ.js";import{p as Lt,s as B,a as st,b as Bt,e as Ot,$ as jt,c as a,d as s,g as e,r,f as $,t as O,h as Pt,n as D}from"../chunks/N1otwjTT.js";import{i as j}from"../chunks/CWp393YG.js";import{e as M,i as X}from"../chunks/CxGl9W59.js";import{h as Ct,s as S,c as ot}from"../chunks/DtPs97YY.js";import{r as Dt}from"../chunks/uT__Kkxm.js";import{b as qt}from"../chunks/DLE3Upo7.js";var At=y("<button> </button>"),Wt=y('<div class="text-gray-400">Loading...</div>'),Et=y('<div class="grid grid-cols-2 md:grid-cols-5 gap-4"><div class="card text-center"><p> </p> <p class="text-xs text-gray-400">Protection</p></div> <div class="card text-center"><p class="text-2xl font-bold"> </p> <p class="text-xs text-gray-400">DNS Queries</p></div> <div class="card text-center"><p class="text-2xl font-bold text-red-400"> </p> <p class="text-xs text-gray-400">Blocked</p></div> <div class="card text-center"><p class="text-2xl font-bold"> </p> <p class="text-xs text-gray-400">Block Rate</p></div> <div class="card text-center"><p class="text-2xl font-bold"> </p> <p class="text-xs text-gray-400">Avg Response</p></div></div>'),Jt=y('<tr class="border-b border-gray-700/50 hover:bg-gray-700/30"><td class="py-1 pr-4 text-gray-400"> </td><td class="py-1 pr-4"> </td><td class="py-1 pr-4 font-mono text-xs"> </td><td class="py-1 pr-4 text-gray-400"> </td><td> </td><td class="py-1"><div class="flex gap-1"><button class="px-2 py-0.5 text-xs bg-green-600/20 text-green-400 hover:bg-green-600/40 rounded" title="Whitelist this domain">Allow</button> <button class="px-2 py-0.5 text-xs bg-red-600/20 text-red-400 hover:bg-red-600/40 rounded" title="Block this domain">Block</button></div></td></tr>'),It=y('<div class="card"><h3 class="text-lg font-semibold mb-3">Recent DNS Queries</h3> <div class="overflow-x-auto max-h-96 overflow-y-auto"><table class="w-full text-sm"><thead class="sticky top-0 bg-gray-800"><tr class="text-left text-gray-400 border-b border-gray-700"><th class="pb-2 pr-4">Time</th><th class="pb-2 pr-4">Client</th><th class="pb-2 pr-4">Domain</th><th class="pb-2 pr-4">Type</th><th class="pb-2 pr-4">Status</th><th class="pb-2">Actions</th></tr></thead><tbody></tbody></table></div></div>'),Qt=y('<div class="flex items-center justify-between p-3 bg-gray-700/50 rounded"><div><p class="font-medium"> </p> <p class="text-xs text-gray-400"> </p></div> <span> </span></div>'),Gt=y('<div class="card"><h3 class="text-lg font-semibold mb-3">Filter Lists</h3> <div class="space-y-2"></div></div>'),Ut=y('<div class="flex items-center justify-between p-2 bg-gray-700/50 rounded font-mono text-sm"><span> </span> <button class="text-gray-400 hover:text-red-400 px-2">X</button></div>'),zt=y('<p class="text-gray-500 text-sm">No custom rules defined</p>'),Ht=y('<div class="card"><h3 class="text-lg font-semibold mb-3">Custom Rules</h3> <p class="text-sm text-gray-400 mb-4">Add domains to block or whitelist. Use <code class="bg-gray-700 px-1 rounded">||domain.com^</code> to block, <code class="bg-gray-700 px-1 rounded">@@||domain.com^</code> to whitelist.</p> <div class="flex gap-2 mb-4"><input type="text" placeholder="||ads.example.com^" class="flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500"/> <button class="btn btn-primary">Add Rule</button></div> <div class="space-y-1"></div></div>'),Mt=y('<!> <div class="flex gap-2 border-b border-gray-700 pb-2"><button>Query Log</button> <button>Filter Lists</button> <button>Custom Rules</button></div> <!> <!> <!>',1),Xt=y('<div class="space-y-6"><div class="flex items-center justify-between"><h2 class="text-2xl font-bold">AdGuard Home</h2> <!></div> <!></div>');function se(it,dt){Lt(dt,!0);let b=B(null),K=B(st([])),J=B(st({filters:[],user_rules:[]})),V=B(!0),P=B(""),k=B("overview");async function R(){try{const[t,i,d]=await Promise.all([fetch("/api/adguard/overview"),fetch("/api/adguard/querylog"),fetch("/api/adguard/filters")]);t.ok&&$(b,await t.json(),!0),i.ok&&$(K,await i.json(),!0),d.ok&&$(J,await d.json(),!0)}catch(t){console.error(t)}finally{$(V,!1)}}Tt(()=>{R();const t=setInterval(R,1e4);return()=>clearInterval(t)});async function lt(){(await fetch("/api/adguard/protection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:!e(b).protection_enabled})})).ok&&R()}async function Y(){if(!e(P).trim())return;(await fetch("/api/adguard/rules/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rule:e(P).trim()})})).ok&&($(P,""),R())}async function nt(t){(await fetch("/api/adguard/rules/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rule:t})})).ok&&R()}async function ct(t){if(!t)return;const i=`@@||${t}^`;try{const d=await fetch("/api/adguard/rules/add",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({rule:i})});d.ok?(alert(`Whitelisted: ${t}`),R()):alert(`Failed to whitelist: ${d.status}`)}catch(d){alert(`Error: ${d.message}`)}}async function vt(t){if(!t)return;const i=`||${t}^`;try{const d=await fetch("/api/adguard/rules/add",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({rule:i})});d.ok?(alert(`Blocked: ${t}`),R()):alert(`Failed to block: ${d.status}`)}catch(d){alert(`Error: ${d.message}`)}}function pt(t){try{return new Date(t).toLocaleTimeString()}catch{return t}}function ut(t){return t==="NotFilteredNotFound"||t==="NotFilteredWhiteList"?"text-green-400":t.includes("Filtered")?"text-red-400":"text-gray-400"}function xt(t){return{NotFilteredNotFound:"Allowed",NotFilteredWhiteList:"Whitelisted",FilteredBlackList:"Blocked (blacklist)",FilteredSafeBrowsing:"Blocked (safe browsing)",FilteredParental:"Blocked (parental)",FilteredBlockedService:"Blocked (service)",Rewrite:"Rewritten"}[t]||t}var I=Xt();Ct("zpo34l",t=>{Ot(()=>{jt.title="AdGuard - RouterUI"})});var Q=a(I),bt=s(a(Q),2);{var _t=t=>{var i=At();i.__click=lt;var d=a(i,!0);r(i),O(()=>{S(i,1,`btn ${e(b).protection_enabled?"btn-danger":"btn-primary"}`),v(d,e(b).protection_enabled?"Disable Protection":"Enable Protection")}),f(t,i)};j(bt,t=>{e(b)&&t(_t)})}r(Q);var gt=s(Q,2);{var ft=t=>{var i=Wt();f(t,i)},yt=t=>{var i=Mt(),d=Pt(i);{var ht=l=>{var n=Et(),p=a(n),u=a(p),h=a(u,!0);r(u),D(2),r(p);var _=s(p,2),o=a(_),c=a(o,!0);r(o),D(2),r(_);var x=s(_,2),g=a(x),F=a(g,!0);r(g),D(2),r(x);var m=s(x,2),w=a(m),C=a(w);r(w),D(2),r(m);var T=s(m,2),q=a(T),L=a(q);r(q),D(2),r(T),r(n),O((H,A,W,E)=>{S(u,1,`text-3xl font-bold ${e(b).protection_enabled?"text-green-400":"text-red-400"}`),v(h,e(b).protection_enabled?"ON":"OFF"),v(c,H),v(F,A),v(C,`${W??""}%`),v(L,`${E??""}ms`)},[()=>e(b).dns_queries.toLocaleString(),()=>e(b).blocked_filtering.toLocaleString(),()=>e(b).blocked_percentage.toFixed(1),()=>e(b).avg_processing_time.toFixed(1)]),f(l,n)};j(d,l=>{e(b)&&l(ht)})}var G=s(d,2),U=a(G);U.__click=()=>$(k,"overview");var z=s(U,2);z.__click=()=>$(k,"filters");var Z=s(z,2);Z.__click=()=>$(k,"rules"),r(G);var tt=s(G,2);{var mt=l=>{var n=It(),p=s(a(n),2),u=a(p),h=s(a(u));M(h,21,()=>e(K).slice(0,50),X,(_,o)=>{var c=Jt(),x=a(c),g=a(x,!0);r(x);var F=s(x),m=a(F,!0);r(F);var w=s(F),C=a(w,!0);r(w);var T=s(w),q=a(T,!0);r(T);var L=s(T),H=a(L,!0);r(L);var A=s(L),W=a(A),E=a(W);E.__click=()=>{var N;return ct((N=e(o).question)==null?void 0:N.name)};var $t=s(E,2);$t.__click=()=>{var N;return vt((N=e(o).question)==null?void 0:N.name)},r(W),r(A),r(c),O((N,St,Rt)=>{var rt,at;v(g,N),v(m,e(o).client),v(C,((rt=e(o).question)==null?void 0:rt.name)||"-"),v(q,((at=e(o).question)==null?void 0:at.qtype)||"-"),S(L,1,`py-1 pr-4 ${St??""}`),v(H,Rt)},[()=>pt(e(o).time),()=>ut(e(o).reason),()=>xt(e(o).reason)]),f(_,c)}),r(h),r(u),r(p),r(n),f(l,n)};j(tt,l=>{e(k)==="overview"&&l(mt)})}var et=s(tt,2);{var wt=l=>{var n=Gt(),p=s(a(n),2);M(p,21,()=>e(J).filters,X,(u,h)=>{var _=Qt(),o=a(_),c=a(o),x=a(c,!0);r(c);var g=s(c,2),F=a(g);r(g),r(o);var m=s(o,2),w=a(m,!0);r(m),r(_),O(C=>{v(x,e(h).name),v(F,`${C??""} rules`),S(m,1,ot(e(h).enabled?"text-green-400":"text-gray-500")),v(w,e(h).enabled?"Enabled":"Disabled")},[()=>e(h).rules_count.toLocaleString()]),f(u,_)}),r(p),r(n),f(l,n)};j(et,l=>{e(k)==="filters"&&l(wt)})}var kt=s(et,2);{var Ft=l=>{var n=Ht(),p=s(a(n),4),u=a(p);Dt(u),u.__keydown=o=>o.key==="Enter"&&Y();var h=s(u,2);h.__click=Y,r(p);var _=s(p,2);M(_,21,()=>e(J).user_rules,X,(o,c)=>{var x=Ut(),g=a(x),F=a(g,!0);r(g);var m=s(g,2);m.__click=()=>nt(e(c)),r(x),O(w=>{S(g,1,w),v(F,e(c))},[()=>ot(e(c).startsWith("@@")?"text-green-400":"text-red-400")]),f(o,x)},o=>{var c=zt();f(o,c)}),r(_),r(n),qt(u,()=>e(P),o=>$(P,o)),f(l,n)};j(kt,l=>{e(k)==="rules"&&l(Ft)})}O(()=>{S(U,1,`px-4 py-2 rounded-t ${e(k)==="overview"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`),S(z,1,`px-4 py-2 rounded-t ${e(k)==="filters"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`),S(Z,1,`px-4 py-2 rounded-t ${e(k)==="rules"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`)}),f(t,i)};j(gt,t=>{e(V)?t(ft):t(yt,!1)})}r(I),f(it,I),Bt()}Nt(["click","keydown"]);export{se as component};
